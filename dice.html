<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 
    3D骰子模拟器 - 主要功能：
    1. 模拟3D骰子投掷效果
    2. 支持多骰子投掷，支持配置骰子数量
    3. 显示投掷结果
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D骰子模拟器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .controls {
            margin-bottom: 20px;
        }
        .dice-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .dice {
            width: 100px;
            height: 100px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s ease;
        }
        .face {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid #333;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            background-color: white;
        }
        .face-1 { transform: translateZ(50px); }
        .face-2 { transform: rotateY(180deg) translateZ(50px); }
        .face-3 { transform: rotateY(90deg) translateZ(50px); }
        .face-4 { transform: rotateY(-90deg) translateZ(50px); }
        .face-5 { transform: rotateX(90deg) translateZ(50px); }
        .face-6 { transform: rotateX(-90deg) translateZ(50px); }
        .dot {
            width: 15px;
            height: 15px;
            background-color: black;
            border-radius: 50%;
            position: absolute;
        }
        .stats {
            margin-top: 20px;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>3D骰子模拟器</h1>
    <div class="controls">
        <label for="diceCount">骰子数量:</label>
        <input type="number" id="diceCount" min="1" max="10" value="1">
    </div>
    
    <div class="dice-container" id="diceContainer"></div>
    
    <button onclick="rollDice()">掷骰子</button>
    <div class="stats" id="stats">
        <h2>统计结果</h2>
        <div id="resultList"></div>
        <p id="total">总和: 0</p>
    </div>

    <script>
        function createDice() {
            const dice = document.createElement('div');
            dice.className = 'dice';
            
            for (let i = 1; i <= 6; i++) {
                const face = document.createElement('div');
                face.className = `face face-${i}`;
                
                // 创建骰子点数
                if (i === 1) {
                    const dot = document.createElement('div');
                    dot.className = 'dot';
                    dot.style.top = '50%';
                    dot.style.left = '50%';
                    dot.style.transform = 'translate(-50%, -50%)';
                    face.appendChild(dot);
                } else if (i === 2) {
                    for (let j = 0; j < 2; j++) {
                        const dot = document.createElement('div');
                        dot.className = 'dot';
                        dot.style.top = j === 0 ? '25%' : '75%';
                        dot.style.left = j === 0 ? '25%' : '75%';
                        dot.style.transform = 'translate(-50%, -50%)';
                        face.appendChild(dot);
                    }
                } else if (i === 3) {
                    for (let j = 0; j < 3; j++) {
                        const dot = document.createElement('div');
                        dot.className = 'dot';
                        dot.style.top = j === 0 ? '25%' : j === 1 ? '50%' : '75%';
                        dot.style.left = j === 0 ? '25%' : j === 1 ? '50%' : '75%';
                        dot.style.transform = 'translate(-50%, -50%)';
                        face.appendChild(dot);
                    }
                } else if (i === 4) {
                    for (let j = 0; j < 4; j++) {
                        const dot = document.createElement('div');
                        dot.className = 'dot';
                        dot.style.top = j % 2 === 0 ? '25%' : '75%';
                        dot.style.left = j < 2 ? '25%' : '75%';
                        dot.style.transform = 'translate(-50%, -50%)';
                        face.appendChild(dot);
                    }
                } else if (i === 5) {
                    for (let j = 0; j < 5; j++) {
                        const dot = document.createElement('div');
                        dot.className = 'dot';
                        if (j === 4) {
                            dot.style.top = '50%';
                            dot.style.left = '50%';
                        } else {
                            dot.style.top = j % 2 === 0 ? '25%' : '75%';
                            dot.style.left = j < 2 ? '25%' : '75%';
                        }
                        dot.style.transform = 'translate(-50%, -50%)';
                        face.appendChild(dot);
                    }
                } else if (i === 6) {
                    for (let j = 0; j < 6; j++) {
                        const dot = document.createElement('div');
                        dot.className = 'dot';
                        dot.style.top = j < 3 ? '25%' : '75%';
                        dot.style.left = j % 3 === 0 ? '20%' : j % 3 === 1 ? '50%' : '80%';
                        dot.style.transform = 'translate(-50%, -50%)';
                        face.appendChild(dot);
                    }
                }
                
                dice.appendChild(face);
            }
            
            return dice;
        }
        
        function rollDice() {
            const diceCount = parseInt(document.getElementById('diceCount').value);
            const diceContainer = document.getElementById('diceContainer');
            const resultList = document.getElementById('resultList');
            const totalElement = document.getElementById('total');
            
            // 清空容器
            diceContainer.innerHTML = '';
            resultList.innerHTML = '';
            totalElement.innerHTML = '';

            let total = 0;
            const results = [];
            
            for (let i = 0; i < diceCount; i++) {
                const dice = createDice();
                const result = Math.floor(Math.random() * 6) + 1;
                
                // 设置随机旋转角度并添加动画效果
                const rotations = {
                    1: {x: 0, y: 0},       // 点数1朝向用户
                    2: {x: 0, y: 180},     // 点数2朝向用户
                    3: {x: 0, y: -90},      // 点数3朝向用户
                    4: {x: 0, y: 90},     // 点数4朝向用户
                    5: {x: -90, y: 0},      // 点数5朝向用户
                    6: {x: 90, y: 0}      // 点数6朝向用户
                };
                
                // 更真实的骰子旋转效果，增加随机性和物理感
                const randomMultiplier = 5 + Math.random() * 5; // 5-10倍随机旋转
                const initialXRot = rotations[result].x + Math.floor(Math.random() * 360) * randomMultiplier;
                const initialYRot = rotations[result].y + Math.floor(Math.random() * 360) * randomMultiplier;
                const initialZRot = Math.floor(Math.random() * 360) * randomMultiplier;
                console.log('initialXRot:', initialXRot, 'initialYRot:', initialYRot, 'initialZRot:', initialZRot);
                
                dice.style.transform = `rotateX(${initialXRot}deg) rotateY(${initialYRot}deg) rotateZ(${initialZRot}deg)`;
                dice.style.transition = 'transform 1.5s cubic-bezier(0.2, 0.6, 0.1, 1)';
                
                // 调整显示点数并确保点数朝向用户
                setTimeout(() => {
                    const finalX = rotations[result].x;
                    const finalY = rotations[result].y;
                    dice.style.transform = `rotateX(${finalX}deg) rotateY(${finalY}deg)`;
                    
                    // 添加掷骰子音效
                    const audio = new Audio('https://cdn.pixabay.com/download/audio/2023/03/14/audio_7763cd5c8a.mp3?filename=dice-142528.mp3');
                    audio.play();
                    
                    // 添加震动效果
                    if ('vibrate' in navigator) {
                        navigator.vibrate([100, 50, 100]);
                    }
                }, 1000);
                
                diceContainer.appendChild(dice);
                results.push(result);
                total += result;
                
                // 显示单个结果（延迟到动画结束后）
                setTimeout(() => {
                    const resultItem = document.createElement('p');
                    resultItem.textContent = `骰子 ${i + 1}: ${result}`;
                    resultList.appendChild(resultItem);
                    
                    // 如果是最后一个骰子，显示总和
                    if (i === diceCount - 1) {
                        totalElement.textContent = `总和: ${total}`;
                    }
                }, 2000); // 1.5秒后显示，与动画时间同步
            }
        }
        // 检测设备晃动
        let lastAcceleration = { x: null, y: null, z: null };
        const shakeThreshold = 15; // 晃动阈值
        
        window.addEventListener('devicemotion', function(event) {
            const acceleration = event.accelerationIncludingGravity;
            
            // 如果是第一次获取数据，直接返回
            if (lastAcceleration.x === null) {
                lastAcceleration = {
                    x: acceleration.x,
                    y: acceleration.y,
                    z: acceleration.z
                };
                return;
            }
            
            // 计算加速度变化
            const deltaX = Math.abs(acceleration.x - lastAcceleration.x);
            const deltaY = Math.abs(acceleration.y - lastAcceleration.y);
            const deltaZ = Math.abs(acceleration.z - lastAcceleration.z);
            
            // 更新上一次的加速度值
            lastAcceleration = {
                x: acceleration.x,
                y: acceleration.y,
                z: acceleration.z
            };
            
            // 如果变化超过阈值，触发掷骰子
            if ((deltaX > shakeThreshold && deltaY > shakeThreshold) || 
                (deltaX > shakeThreshold && deltaZ > shakeThreshold) || 
                (deltaY > shakeThreshold && deltaZ > shakeThreshold)) {
                rollDice();
            }
        });
        // 初始化一个骰子
        window.onload = function() {
            rollDice();
        };
    </script>
</body>
</html>
